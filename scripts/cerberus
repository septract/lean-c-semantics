#!/bin/bash
# Wrapper to run Cerberus using the local build (binary directly)
# Usage: ./scripts/cerberus [args...]

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_DIR="$(dirname "$SCRIPT_DIR")"
CERBERUS_DIR="$PROJECT_DIR/cerberus"
OPAM_SWITCH="cerberus-414"
CERBERUS_BIN="$CERBERUS_DIR/_build/default/backend/driver/main.exe"

# Verify binary exists
if [[ ! -x "$CERBERUS_BIN" ]]; then
    echo "Error: Cerberus binary not found at $CERBERUS_BIN"
    echo "Run 'make cerberus' first"
    exit 1
fi

# Run cerberus binary directly (opam exec sets up library paths)
OPAMSWITCH=$OPAM_SWITCH opam exec -- "$CERBERUS_BIN" --runtime="$CERBERUS_DIR/_build/install/default" "$@"
